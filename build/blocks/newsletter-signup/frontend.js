(()=>{"use strict";function e(e){if(!e||e.dataset.initialized)return;const i=e.querySelector(".newsletter-form"),s=e.dataset.layout||"inline-form";i&&(window.BlockIntersectionObserver.animateOnScroll([e],"animate-fade-in animate-slide-up"),new t(i,e,{layout:s,integrationService:e.dataset.integrationService||"mailchimp",apiKey:e.dataset.apiKey||"",listId:e.dataset.listId||"",enableCaptcha:"true"===e.dataset.enableCaptcha,enableDoubleOptin:"false"!==e.dataset.enableDoubleOptin,successMessage:e.dataset.successMessage||"Thank you for subscribing!",errorMessage:e.dataset.errorMessage||"Please enter a valid email address.",redirectUrl:e.dataset.redirectUrl||""}).init(),e.dataset.initialized="true")}document.addEventListener("blockPresetsReady",function(t){"newsletter-signup"===t.detail.blockName&&document.querySelectorAll(".wp-block-tailwind-starter-newsletter-signup").forEach(e)});class t{constructor(e,t,i={}){this.form=e,this.block=t,this.options=i,this.emailInput=null,this.submitButton=null,this.messageContainer=null,this.isSubmitting=!1,this.validationRules={email:{required:!0,pattern:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,message:"Please enter a valid email address"}}}init(){this.createFormHTML(),this.bindEvents(),this.setupAccessibility(),"modal"!==this.options.layout&&"slide-in"!==this.options.layout||this.setupAdvancedLayout()}createFormHTML(){this.emailInput=this.form.querySelector('input[type="email"]')||this.createEmailInput(),this.submitButton=this.form.querySelector('button[type="submit"]')||this.createSubmitButton(),this.messageContainer=this.form.querySelector(".form-messages")||this.createMessageContainer(),this.form.setAttribute("novalidate",""),this.form.addEventListener("submit",this.handleSubmit.bind(this))}createEmailInput(){const e=document.createElement("input");return e.type="email",e.name="email",e.placeholder=this.block.dataset.placeholder||"Enter your email address",e.className="block-input",e.required=!0,e.setAttribute("aria-describedby","email-error"),(this.form.querySelector(".input-container")||this.form).appendChild(e),e}createSubmitButton(){const e=document.createElement("button");return e.type="submit",e.textContent=this.block.dataset.buttonText||"Subscribe",e.className="block-btn-primary",this.form.appendChild(e),e}createMessageContainer(){const e=document.createElement("div");return e.className="form-messages mt-3",e.setAttribute("aria-live","polite"),this.form.appendChild(e),e}bindEvents(){this.emailInput.addEventListener("blur",()=>{this.validateField("email",this.emailInput.value)}),this.emailInput.addEventListener("input",()=>{this.clearFieldError("email")}),this.submitButton.addEventListener("click",()=>{this.isSubmitting||this.trackEvent("newsletter_submit_attempt")})}setupAccessibility(){if(window.BlockAccessibility){if(!this.form.querySelector('label[for="'+this.emailInput.id+'"]')){const e=document.createElement("label");e.htmlFor=this.emailInput.id||"newsletter-email",e.textContent="Email Address",e.className="sr-only",this.emailInput.parentNode.insertBefore(e,this.emailInput)}window.BlockAccessibility.createKeyboardNavigation(this.form,"input, button",{onItemSelect:e=>{"submit"===e.type&&this.handleSubmit(new Event("submit"))}})}}setupAdvancedLayout(){"modal"===this.options.layout?this.setupModalLayout():"slide-in"===this.options.layout&&this.setupSlideInLayout()}setupModalLayout(){const e=document.createElement("button");e.textContent="Subscribe to Newsletter",e.className="block-btn-primary",this.form.style.display="none",this.block.appendChild(e),e.addEventListener("click",()=>{if(window.BlockModalManager){const e=window.BlockModalManager.create({title:"Subscribe to Newsletter",content:this.form.outerHTML,size:"medium",onShow:()=>{const t=e.element.querySelector(".newsletter-form");t&&this.initModalForm(t)}});e.show()}})}setupSlideInLayout(){setTimeout(()=>{this.form.classList.add("slide-in-active")},3e3)}initModalForm(e){const i=new t(e,this.block,this.options);i.createFormHTML(),i.bindEvents()}async handleSubmit(e){if(e.preventDefault(),!this.isSubmitting)if(this.validateForm()){this.isSubmitting=!0,this.setLoadingState(!0);try{const e=this.getFormData(),t=await this.submitToService(e);t.success?(this.handleSuccess(t),this.trackEvent("newsletter_signup_success")):(this.handleError(t.message||this.options.errorMessage),this.trackEvent("newsletter_signup_error",{error:t.message}))}catch(e){console.error("Newsletter signup error:",e),this.handleError(this.options.errorMessage),this.trackEvent("newsletter_signup_error",{error:e.message})}finally{this.isSubmitting=!1,this.setLoadingState(!1)}}else this.announceError("Please fix the errors below")}validateForm(){let e=!0;return this.validateField("email",this.emailInput.value)||(e=!1),this.options.enableCaptcha&&"undefined"!=typeof grecaptcha&&(grecaptcha.getResponse()||(this.showFieldError("captcha","Please complete the CAPTCHA"),e=!1)),e}validateField(e,t){const i=this.validationRules[e];return!(i&&(!i.required||t&&""!==t.trim()?i.pattern&&t&&!i.pattern.test(t)?(this.showFieldError(e,i.message),1):(this.clearFieldError(e),0):(this.showFieldError(e,`${e} is required`),1)))}showFieldError(e,t){const i=`${e}-error`;let s=this.form.querySelector(`#${i}`);if(!s){s=document.createElement("div"),s.id=i,s.className="block-error",s.setAttribute("role","alert");const t=this.form.querySelector(`[name="${e}"]`);t&&t.parentNode.insertBefore(s,t.nextSibling)}s.textContent=t;const r=this.form.querySelector(`[name="${e}"]`);r&&(r.setAttribute("aria-invalid","true"),r.setAttribute("aria-describedby",i))}clearFieldError(e){const t=this.form.querySelector(`#${e}-error`);t&&t.remove();const i=this.form.querySelector(`[name="${e}"]`);i&&(i.setAttribute("aria-invalid","false"),i.removeAttribute("aria-describedby"))}getFormData(){return{email:this.emailInput.value.trim(),source:"wordpress-block",timestamp:(new Date).toISOString(),url:window.location.href,referrer:document.referrer}}async submitToService(e){const t=window.ajaxurl||"/wp-admin/admin-ajax.php",i=await fetch(t,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"newsletter_signup",nonce:window.newsletterNonce||"",email:e.email,service:this.options.integrationService,list_id:this.options.listId,double_optin:this.options.enableDoubleOptin?"1":"0"})});return await i.json()}handleSuccess(e){this.showMessage(this.options.successMessage,"success"),this.clearForm(),this.options.redirectUrl&&setTimeout(()=>{window.location.href=this.options.redirectUrl},2e3),this.announceSuccess(this.options.successMessage)}handleError(e){this.showMessage(e,"error"),this.announceError(e)}showMessage(e,t){this.messageContainer.className="form-messages mt-3 "+("success"===t?"text-green-600":"text-red-600"),this.messageContainer.textContent=e}clearForm(){this.emailInput.value="",this.clearFieldError("email")}setLoadingState(e){e?(this.submitButton.disabled=!0,this.submitButton.innerHTML=`\n                <div class="block-spinner w-4 h-4 mr-2"></div>\n                ${this.submitButton.textContent}\n            `):(this.submitButton.disabled=!1,this.submitButton.textContent=this.block.dataset.buttonText||"Subscribe")}announceSuccess(e){window.BlockAccessibility&&window.BlockAccessibility.announceToScreenReader(e,"polite")}announceError(e){window.BlockAccessibility&&window.BlockAccessibility.announceToScreenReader(e,"assertive")}trackEvent(e,t={}){"undefined"!=typeof gtag&&gtag("event",e,t),"undefined"!=typeof fbq&&fbq("track","Lead",t),window.newsletterAnalytics&&window.newsletterAnalytics.track(e,t)}}function i(){window.BlockAssetManager&&window.BlockAssetManager.registerBlockAssets("newsletter-signup",{presets:["accessibility","animations"],priority:"normal"})}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",i):i(),document.addEventListener("DOMContentLoaded",()=>{if(document.querySelectorAll('.wp-block-tailwind-starter-newsletter-signup[data-enable-captcha="true"]').length>0&&!window.grecaptcha){const e=document.createElement("script");e.src="https://www.google.com/recaptcha/api.js",e.async=!0,document.head.appendChild(e)}})})();